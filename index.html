<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN" "http://www.w3.org/TR/html4/frameset.dtd">

<head>
	<title>Why Dvorak?</title>

	<script type="text/javascript" src="code.js"></script>
	<script type="text/javascript" src="layouts/qwerty.js"></script>
	<script type="text/javascript" src="layouts/dvorak.js"></script>
	<script type="text/javascript" src="layouts/colemak.js"></script>
	<script type="text/javascript" src="layouts/tr-f.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
	<script src="https://code.highcharts.com/highcharts.js"></script>

	<link rel="stylesheet" type="text/css" href="css/loading-anim.css"></script>
	<link rel="stylesheet" type="text/css" href="css/style.css"></script>
</head>

<body>
	<h1>Which Is The Best Keyboard Layout?</h1>
	
	Out of <span id="layouts">most popular keyboard layouts</span>, which is the best?

	<div id="charts">
		<div id="fingerChart" class="chart"></div>
		<div id="handChart" class="chart"></div>
		<div id="distanceChart" class="chart"></div>
	</div>

	<!--
	<div id="texts">
		<div id="text-0" class="with-loading-anim">
			<div class="loading-anim hidden">
				<img src="loading.gif"></img>
			</div>
			<div class="contents" readonly="true"></div>
		</div>
	</div>
	-->

	<hr/>

	<h2>Conclusion</h2>
	<ul>
		<li>Layout with least travel: <span id="bestDistance" class="best">...</span></li>
		<li>Layout with least same-hand-count: <span id="bestHand" class="best">...</span></li>
		<li>Layout with least same-finger-count: <span id="bestFinger" class="best">...</span></li>
	</ul>

	<p><span id="bestLayout"></p>

	<hr/>

	<div style="font-size: 0.8em">
		<h4>Same Finger Count</h4>
		<p>Same Finger Count indicates how many times the same finger was used consecutively.</p>
		<p>With QWERTY keyboard when typing the word "yumminess", you will have to use your right-index finger 4 times consecutively. We want this number to be low, as that means when one finger presses a key the other can get ready to press the next key.</p>
		<p>The number in the chart is normalized for a text length of 100 characters.</p>

		<h4>Same Hand Count</h4>
		<p>Same Hand Count indicates how many times the same hand was used consecutively.</p>
		<p>With QWERTY keyboard to type the word "starwars" your right hand will sit idle while your left hand types the entire word.</p>
		<p>The number in the chart is normalized for a text length of 100 characters.</p>

		<h4>Distance Travelled</h4>
		<p>Distance Travelled shows how far the fingers had to travel from their resting positions in the home row.</p>
		<p>For the QWERTY keyboard, the "F" key is considered to be at distance 0, because the left-index finger rests on it. "G" key is at distance 1 and "T" is at distance 2.</p>
		<p>The number in the chart is normalized for a text length of 100 characters.</p>
	</div>

	<div id="signature">
		No rights reserved. Made by aecepoglu: <script type="text/javascript">document.write("aecepoglu" + "@" + (2>1 ? "fastmail.fm" : "") + "");</script>
		<a href="https://github.com/aecepoglu/why-dvorak">source code</a>
	</div>

	<script type="text/javascript">
		layouts = layouts.filter(l => l.isEnabled);
		$("#layouts").html(layouts.map(x => x.name).join(", "));

		var $textContainer;
		var $textarea;

		const CHART_PROPS = {
			chart: {
				type: "column"
			},
			title: {
				text: ""
			},
			subtitle: {
				text: ""
			},
			xAxis: {
				categories: [],
				crosshair: true
			},
			yAxis: {
				min: 0,
			},
			tooltip: {},
			plotOptions: {
				column: {
					pointPadding: 0.2,
					borderWidth: 0
				}
			},
			series: layouts.map(l => {
				return {
					name: l.name,
					data: [0]
				};
			})
		};
		const TEXTS = [
			"texts/common-words.txt",
			"texts/sherlock.txt",
			"texts/dvorak.txt",
		];

		var sameFingerChart = Highcharts.chart('fingerChart', $.extend(true, {
			yAxis: {
				title: {
					text: "Same Finger Count %"
				}
			},
		}, CHART_PROPS));
		var sameHandChart = Highcharts.chart('handChart', $.extend(true, {
			yAxis: {
				title: {
					text: "Same Hand Count %"
				}
			},
		}, CHART_PROPS));
		var distanceChart = Highcharts.chart('distanceChart', $.extend(true, {
			yAxis: {
				title: {
					text: "Distance Travelled %"
				}
			},
		}, CHART_PROPS));

		function showFile(path, $container) {
			//$container.addClass("loading");

			return getFile(path).then(t => {
				//$container.find(".contents").html(t);
				//$container.removeClass("loading");

				return t;
			});
		}

		function analyzeFile(path) {
			showFile(path).then(t => {
				let x = analyze(t);
				console.log(x);
			});
		}

		function findBest(key, arr) {
			var bestIndex = -1;
			var bestVal = Number.MAX_SAFE_INTEGER;
			arr.forEach((it, i) => {
				let val = it.stats[key].reduce((acc, x) => (acc+x));
				if (val < bestVal) {
					bestIndex = i;
					bestVal = val;
				}
			});

			return arr[bestIndex].layout;
		}

		$(function() {
			let $texts = $("#texts");
			let promises = TEXTS.map((path, i) => {
				let $container = $($texts.children()[i]);
				return showFile(path, $container);
			});

			let inputNames = TEXTS.map(t => t.split("/").pop());
			sameFingerChart.xAxis[0].update({categories: inputNames});
			sameHandChart.xAxis[0].update({categories: inputNames});
			distanceChart.xAxis[0].update({categories: inputNames});

			Promise.all(promises).then(texts => {
				return texts.map(t => {
					return analyze(t);
				});
			}).then(listsOfResults => {
				/* listsOfResults: [
					[{
						layout: "dvorak",
						stats: {
							sameFingerCount: number,
							sameHandCount: number,
							distanceTravelled: number
						}
					}, {
						layout: "qwerty",
						stats: {
							sameFingerCount: number,
							sameHandCount: number,
							distanceTravelled: number
						}
					}]
				]
				*/

				let results = listsOfResults.reduce((acc, statsOfLayouts) => {
					statsOfLayouts.forEach((r, i) => {
						acc[i].stats.sameFingerCount.push(r.stats.sameFingerCount);
						acc[i].stats.sameHandCount.push(r.stats.sameFingerCount);
						acc[i].stats.distanceTravelled.push(r.stats.distanceTravelled);
					});

					return acc;
				}, layouts.map(l => {
					return {
						layout: l.name,
						stats: {
							sameFingerCount: [],
							sameHandCount: [],
							distanceTravelled: []
						}
					};
				}));

				console.log(results);

				results.forEach(({layout, stats}) => {
					sameFingerChart.series
						.find(x => x.name == layout)
						.setData(stats.sameFingerCount);
					sameHandChart.series
						.find(x => x.name == layout)
						.setData(stats.sameHandCount);
					distanceChart.series
						.find(x => x.name == layout)
						.setData(stats.distanceTravelled);
				});

				let bestDistanceLayout = findBest("distanceTravelled", results);
				let bestHandLayout = findBest("sameHandCount", results);
				let bestFingerLayout = findBest("sameFingerCount", results);

				$("#bestDistance").html(bestDistanceLayout);
				$("#bestHand").html(bestHandLayout);
				$("#bestFinger").html(bestFingerLayout);
			}).catch(err => {
				console.log("error", err);
			});
		});
	</script>
</body>
